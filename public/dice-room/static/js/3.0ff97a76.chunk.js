(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[3],{1:function(e,t,n){"use strict";n.r(t);var a,c,s,r,i,o,u=n(5),d=n.n(u),l=n(55),j=n.n(l),b=(n(59),n(60),n(91)),m=n(89),O=n(90),h=n(61),g=n(62),f=n(92),p=n(88),x=n(63),I=n(86),v=n(3),C=n(71),y=(n(84),n(20)),k=new I.HttpLink({uri:"https://parvifolium.net:4000/dice-room-graphql"}),$=new C.a({uri:"wss://parvifolium.net:4000/dice-room-graphql/subscriptions",options:{reconnect:!0}}),w=Object(I.split)((function(e){var t=e.query,n=Object(v.q)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),$,k),N=new I.ApolloClient({link:w,cache:new I.InMemoryCache}),S=Object(I.gql)(a||(a=Object(x.a)(["\n  mutation verifyUser($id: ID!, $name: String!) {\n    verifyUser(id: $id, name: $name)\n  }\n"]))),F=Object(I.gql)(c||(c=Object(x.a)(["\nmutation createUser($name: String!) {\n  createUser(name: $name) {\n    id\n    name\n  }\n}\n"]))),M=Object(I.gql)(s||(s=Object(x.a)(["\n  query getMessages {\n    messages {\n      id\n      user {\n        id\n        name\n      }\n      text\n      roll {\n        id\n        createdAt\n        diceCount\n        diceFaces\n        result\n      }\n    }\n  }\n"]))),q=Object(I.gql)(r||(r=Object(x.a)(["\n  mutation createMessage($userId: ID!, $text: String!) {\n    createMessage(userId: $userId, text: $text) {\n      id\n      user {\n        id\n        name\n      }\n      text\n    }\n  }\n"]))),J=Object(I.gql)(i||(i=Object(x.a)(["\n  mutation createRoll($userId: ID!, $diceCount: Int!, $diceFaces: Int!) {\n    createRoll(userId: $userId, diceCount: $diceCount, diceFaces: $diceFaces) {\n      id\n      createdAt\n      user {\n        id\n        createdAt\n        name\n      }\n      diceCount\n      diceFaces\n      result\n    }\n  }\n"]))),D=Object(I.gql)(o||(o=Object(x.a)(["\n  subscription messageCreated {\n    messageCreated {\n      id\n      user {\n        id\n        name\n      }\n      text\n    }\n  }\n"]))),U=function(e){Object(f.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return(e=t.call.apply(t,[this].concat(c))).scrollToBottom=function(){e.messagesEnd.scrollIntoView({behavior:"smooth"})},e.scrollToBottomFast=function(){e.messagesEnd.scrollIntoView({behavior:"auto"})},e}return Object(g.a)(n,[{key:"componentDidMount",value:function(){this.props.subscribeToNewMessages(),this.scrollToBottomFast()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;return Object(y.jsxs)("ul",{id:"messages",className:"messages",children:[this.props.messages.map((function(t){var n=t.id,a=t.user,c=t.text,s=t.roll;return Object(y.jsxs)("li",{className:"message ".concat(parseInt(e.props.userId)===parseInt(a.id)?"self":""),children:[Object(y.jsx)("div",{className:"message-name",children:parseInt(e.props.userId)!==parseInt(a.id)?Object(y.jsx)(y.Fragment,{children:a.name}):Object(y.jsx)(y.Fragment,{})}),Object(y.jsx)("div",{className:"message-text",children:s?Object(y.jsxs)("span",{children:[Object(y.jsxs)("em",{children:[s.diceCount,"d",s.diceFaces]})," \u2192 ",Object(y.jsx)("strong",{children:s.result})]}):Object(y.jsx)("span",{children:c})})]},n)})),Object(y.jsx)("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})]})}}]),n}(d.a.Component);function E(e){var t=Object(I.useQuery)(M),n=t.loading,a=t.error,c=t.data,s=t.subscribeToMore;return n?"Loading...":a?"Error! ".concat(a.message):Object(y.jsx)(U,{messages:c.messages,userId:e.userId,subscribeToNewMessages:function(){return s({document:D,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.messageCreated;return Object.assign({},e,{messages:[].concat(Object(O.a)(e.messages),[a])})}})}})}function T(){var e=Object(I.useMutation)(S),t=Object(m.a)(e,1)[0],n=Object(I.useMutation)(F),a=Object(m.a)(n,1)[0],c=Object(I.useMutation)(q),s=Object(m.a)(c,1)[0],r=Object(I.useMutation)(J),i=Object(m.a)(r,1)[0],o=d.a.useState({hasJoined:!1,nameInput:"",user:{id:0,name:"Guest"},text:""}),l=Object(m.a)(o,2),j=l[0],O=l[1];Object(u.useEffect)((function(){var e="true"===localStorage.getItem("hasJoined"),n=localStorage.getItem("userId")?parseInt(localStorage.getItem("userId")):0,a=localStorage.getItem("userName")?localStorage.getItem("userName"):"Guest";t({variables:{id:n,name:a}}).then((function(t){t.data.verifyUser?O({hasJoined:e,nameInput:"",user:{id:n,name:a},text:""}):O({hasJoined:!1,nameInput:"",user:{id:0,name:"Guest"},text:""})}))}),[t,j.user.id]);var h=function(){if(j.text.length>0)try{s({variables:{userId:j.user.id,text:j.text}})}catch(e){console.log(e)}O(Object(b.a)(Object(b.a)({},j),{},{text:""}))},g=d.a.useState(!1),f=Object(m.a)(g,2),p=f[0],x=f[1],v=function(e,t){try{i({variables:{userId:j.user.id,diceCount:e,diceFaces:t}})}catch(n){console.log(n)}},C=function(){if(!j.hasJoined&&j.nameInput.length>0)try{a({variables:{name:j.nameInput}}).then((function(e){O(Object(b.a)(Object(b.a)({},j),{},{user:{id:e.data.createUser.id,name:e.data.createUser.name},hasJoined:!0})),localStorage.setItem("hasJoined",!0),localStorage.setItem("userId",e.data.createUser.id),localStorage.setItem("userName",e.data.createUser.name)}))}catch(e){console.log(e)}};return Object(y.jsxs)("div",{id:"outer-container",className:"container",children:[Object(y.jsx)("h1",{children:"Dice Bazaar"}),Object(y.jsx)(E,{userId:j.user.id}),j.hasJoined?Object(y.jsxs)("div",{className:"form-container has-dice",children:[Object(y.jsxs)("div",{id:"dice-modal",className:p?"active":null,children:[Object(y.jsx)("div",{id:"dice-menu-icon",onClick:function(){x(!p)},children:"\ud83c\udfb2"}),Object(y.jsxs)("div",{id:"dice-container",className:"dice-container",children:[Object(y.jsx)("button",{onClick:function(){return v(1,100)},children:"d100"}),Object(y.jsx)("button",{onClick:function(){return v(1,20)},children:"d20"}),Object(y.jsx)("button",{onClick:function(){return v(1,12)},children:"d12"}),Object(y.jsx)("button",{onClick:function(){return v(1,10)},children:"d10"}),Object(y.jsx)("button",{onClick:function(){return v(1,8)},children:"d8"}),Object(y.jsx)("button",{onClick:function(){return v(1,6)},children:"d6"}),Object(y.jsx)("button",{onClick:function(){return v(1,4)},children:"d4"})]}),Object(y.jsx)("div",{id:"dice-container-triangle"})]}),Object(y.jsx)("input",{type:"text",name:"text",id:"text",autoFocus:!0,autoComplete:"off",value:j.text,placeholder:"Enter a message...",onChange:function(e){return O(Object(b.a)(Object(b.a)({},j),{},{text:e.target.value}))},onKeyDown:function(e){13===e.keyCode&&h()}}),Object(y.jsx)("button",{onClick:function(){return h()},children:"Send"})]}):Object(y.jsxs)("div",{className:"form-container",children:[Object(y.jsx)("input",{type:"text",name:"username",id:"username",autoFocus:!0,autoComplete:"off",value:j.nameInput,placeholder:"Choose a name...",onChange:function(e){return O(Object(b.a)(Object(b.a)({},j),{},{nameInput:e.target.value}))},onKeyDown:function(e){13===e.keyCode&&C()}}),Object(y.jsx)("button",{onClick:function(){return C()},children:"Join"})]})]})}var A=function(){return Object(y.jsx)(I.ApolloProvider,{client:N,children:Object(y.jsx)(T,{})})},B=function(){return Object(y.jsx)(A,{})};j.a.render(Object(y.jsx)(B,{}),document.getElementById("app"))},59:function(e,t,n){},84:function(e,t,n){}}]);
//# sourceMappingURL=3.0ff97a76.chunk.js.map