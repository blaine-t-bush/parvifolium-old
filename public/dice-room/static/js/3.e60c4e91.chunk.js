(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[3],{1:function(e,t,n){"use strict";n.r(t);var a,c,s,r,i,o=n(5),u=n.n(o),d=n(50),l=n.n(d),j=(n(54),n(55),n(74)),m=n(72),b=n(56),O=n(57),h=n(75),g=n(73),x=n(58),f=n(70),p=(n(2),n(68),n(20)),I=new f.ApolloClient({uri:"https://parvifolium.net/dice-room-server",cache:new f.InMemoryCache}),v=Object(f.gql)(a||(a=Object(x.a)(["\n  mutation verifyUser($id: ID!, $name: String!) {\n    verifyUser(id: $id, name: $name)\n  }\n"]))),C=Object(f.gql)(c||(c=Object(x.a)(["\nmutation createUser($name: String!) {\n  createUser(name: $name) {\n    id\n    name\n  }\n}\n"]))),y=Object(f.gql)(s||(s=Object(x.a)(["\n  query getMessages {\n    messages {\n      id\n      user {\n        id\n        name\n      }\n      text\n      roll {\n        id\n        createdAt\n        diceCount\n        diceFaces\n        result\n      }\n    }\n  }\n"]))),k=Object(f.gql)(r||(r=Object(x.a)(["\n  mutation createMessage($userId: ID!, $text: String!) {\n    createMessage(userId: $userId, text: $text) {\n      id\n      user {\n        id\n        name\n      }\n      text\n    }\n  }\n"]))),$=Object(f.gql)(i||(i=Object(x.a)(["\n  mutation createRoll($userId: ID!, $diceCount: Int!, $diceFaces: Int!) {\n    createRoll(userId: $userId, diceCount: $diceCount, diceFaces: $diceFaces) {\n      id\n      createdAt\n      user {\n        id\n        createdAt\n        name\n      }\n      diceCount\n      diceFaces\n      result\n    }\n  }\n"]))),S=function(e){Object(h.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(b.a)(this,n);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return(e=t.call.apply(t,[this].concat(c))).scrollToBottom=function(){e.messagesEnd.scrollIntoView({behavior:"smooth"})},e.scrollToBottomFast=function(){e.messagesEnd.scrollIntoView({behavior:"auto"})},e}return Object(O.a)(n,[{key:"componentDidMount",value:function(){this.scrollToBottomFast()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;return Object(p.jsxs)("ul",{id:"messages",className:"messages",children:[this.props.messages.map((function(t){var n=t.id,a=t.user,c=t.text,s=t.roll;return Object(p.jsxs)("li",{className:"message ".concat(parseInt(e.props.userId)===parseInt(a.id)?"self":""),children:[Object(p.jsx)("div",{className:"message-name",children:parseInt(e.props.userId)!==parseInt(a.id)?Object(p.jsx)(p.Fragment,{children:a.name}):Object(p.jsx)(p.Fragment,{})}),Object(p.jsx)("div",{className:"message-text",children:s?Object(p.jsxs)("span",{children:[Object(p.jsxs)("em",{children:[s.diceCount,"d",s.diceFaces]})," \u2192 ",Object(p.jsx)("strong",{children:s.result})]}):Object(p.jsx)("span",{children:c})})]},n)})),Object(p.jsx)("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})]})}}]),n}(u.a.Component);function F(e){var t=Object(f.useQuery)(y,{pollInterval:500}),n=t.loading,a=t.error,c=t.data;return n?"Loading...":a?"Error! ".concat(a.message):Object(p.jsx)(S,{messages:c.messages,userId:e.userId})}function N(){var e=Object(f.useMutation)(v),t=Object(m.a)(e,1)[0],n=Object(f.useMutation)(C),a=Object(m.a)(n,1)[0],c=Object(f.useMutation)(k),s=Object(m.a)(c,1)[0],r=Object(f.useMutation)($),i=Object(m.a)(r,1)[0],d=u.a.useState({hasJoined:!1,nameInput:"",user:{id:0,name:"Guest"},text:""}),l=Object(m.a)(d,2),b=l[0],O=l[1];Object(o.useEffect)((function(){var e="true"===localStorage.getItem("hasJoined"),n=localStorage.getItem("userId")?parseInt(localStorage.getItem("userId")):0,a=localStorage.getItem("userName")?localStorage.getItem("userName"):"Guest";t({variables:{id:n,name:a}}).then((function(t){t.data.verifyUser?O({hasJoined:e,nameInput:"",user:{id:n,name:a},text:""}):O({hasJoined:!1,nameInput:"",user:{id:0,name:"Guest"},text:""})}))}),[t,b.user.id]);var h=function(){if(b.text.length>0)try{s({variables:{userId:b.user.id,text:b.text}})}catch(e){console.log(e)}O(Object(j.a)(Object(j.a)({},b),{},{text:""}))},g=u.a.useState(!1),x=Object(m.a)(g,2),I=x[0],y=x[1],S=function(e,t){try{i({variables:{userId:b.user.id,diceCount:e,diceFaces:t}})}catch(n){console.log(n)}},N=function(){if(!b.hasJoined&&b.nameInput.length>0)try{a({variables:{name:b.nameInput}}).then((function(e){O(Object(j.a)(Object(j.a)({},b),{},{user:{id:e.data.createUser.id,name:e.data.createUser.name},hasJoined:!0})),localStorage.setItem("hasJoined",!0),localStorage.setItem("userId",e.data.createUser.id),localStorage.setItem("userName",e.data.createUser.name)}))}catch(e){console.log(e)}};return Object(p.jsxs)("div",{id:"outer-container",className:"container",children:[Object(p.jsx)("h1",{children:"Dice Bazaar"}),Object(p.jsx)(F,{userId:b.user.id}),b.hasJoined?Object(p.jsxs)("div",{className:"form-container has-dice",children:[Object(p.jsxs)("div",{id:"dice-modal",className:I?"active":null,children:[Object(p.jsx)("div",{id:"dice-menu-icon",onClick:function(){y(!I)},children:"\ud83c\udfb2"}),Object(p.jsxs)("div",{id:"dice-container",className:"dice-container",children:[Object(p.jsx)("button",{onClick:function(){return S(1,100)},children:"d100"}),Object(p.jsx)("button",{onClick:function(){return S(1,20)},children:"d20"}),Object(p.jsx)("button",{onClick:function(){return S(1,12)},children:"d12"}),Object(p.jsx)("button",{onClick:function(){return S(1,10)},children:"d10"}),Object(p.jsx)("button",{onClick:function(){return S(1,8)},children:"d8"}),Object(p.jsx)("button",{onClick:function(){return S(1,6)},children:"d6"}),Object(p.jsx)("button",{onClick:function(){return S(1,4)},children:"d4"})]}),Object(p.jsx)("div",{id:"dice-container-triangle"})]}),Object(p.jsx)("input",{type:"text",name:"text",id:"text",autoFocus:!0,autoComplete:"off",value:b.text,placeholder:"Enter a message...",onChange:function(e){return O(Object(j.a)(Object(j.a)({},b),{},{text:e.target.value}))},onKeyDown:function(e){13===e.keyCode&&h()}}),Object(p.jsx)("button",{onClick:function(){return h()},children:"Send"})]}):Object(p.jsxs)("div",{className:"form-container",children:[Object(p.jsx)("input",{type:"text",name:"username",id:"username",autoFocus:!0,autoComplete:"off",value:b.nameInput,placeholder:"Choose a name...",onChange:function(e){return O(Object(j.a)(Object(j.a)({},b),{},{nameInput:e.target.value}))},onKeyDown:function(e){13===e.keyCode&&N()}}),Object(p.jsx)("button",{onClick:function(){return N()},children:"Join"})]})]})}var J=function(){return Object(p.jsx)(f.ApolloProvider,{client:I,children:Object(p.jsx)(N,{})})},U=function(){return Object(p.jsx)(J,{})};l.a.render(Object(p.jsx)(U,{}),document.getElementById("app"))},54:function(e,t,n){},68:function(e,t,n){}}]);
//# sourceMappingURL=3.e60c4e91.chunk.js.map